<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Live - KJ-Nomad</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <div class="dashboard">
        <h1>Your Session is Live!</h1>
        <p>Your online karaoke session has been created. Use the details below to connect your devices.</p>

        <div class="key-display">
            <h2>ðŸ“¢ Session ID (for Singers & Players)</h2>
            <code id="session-id" title="Click to copy">Loading...</code>
        </div>

        <div class="key-display">
            <h2>ðŸ”‘ Admin Key (for your Local Server)</h2>
            <code id="admin-key" title="Click to copy">Loading...</code>
        </div>

        <div class="instructions">
            <h3>Next Steps:</h3>
            <ol>
                <li><strong>Download and run the KJ-Nomad App</strong> if you haven't already.</li>
                <li>In the app, choose "Connect to an Online Session".</li>
                <li>Enter your Session ID and Admin Key when prompted.</li>
                <li>Tell singers to go to <strong>sing.nomadkaraoke.com</strong> and enter the Session ID.</li>
                <li>Point your player screens to <strong>kj.nomadkaraoke.com/player</strong> and enter the Session ID.</li>
            </ol>
            <div style="text-align:center; display: flex; gap: 1rem; justify-content: center;">
                <a href="#" id="launch-app-link" class="cta-button">ðŸš€ Launch App</a>
                <a href="#" id="download-link" class="cta-button" style="background: var(--dark-card); border: 2px solid var(--pink);">Download App</a>
            </div>
        </div>
    </div>
    <script src="assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sessionDataString = sessionStorage.getItem('kj-nomad-session');
            if (!sessionDataString) {
                document.querySelector('.dashboard').innerHTML = '<h1>Error</h1><p>No session data found. Please <a href="/">create a new session</a>.</p>';
                return;
            }

            const sessionData = JSON.parse(sessionDataString);
            const sessionIdEl = document.getElementById('session-id');
            const adminKeyEl = document.getElementById('admin-key');

            sessionIdEl.textContent = sessionData.sessionId;
            adminKeyEl.textContent = sessionData.adminKey;

            sessionIdEl.addEventListener('click', () => copyToClipboard(sessionData.sessionId, 'Session ID'));
            adminKeyEl.addEventListener('click', () => copyToClipboard(sessionData.adminKey, 'Admin Key'));
            
            // Setup download link
            const downloadLink = document.getElementById('download-link');
            downloadLink.onclick = (e) => {
                e.preventDefault();
                showDownloadOptions(); 
            };

            // Setup launch app link
            const launchAppLink = document.getElementById('launch-app-link');
            launchAppLink.href = `kj-nomad://connect?adminKey=${encodeURIComponent(sessionData.adminKey)}`;
        });

        function copyToClipboard(text, type) {
            navigator.clipboard.writeText(text).then(() => {
                alert(`${type} copied to clipboard!`);
            }, (err) => {
                console.error('Failed to copy: ', err);
                alert(`Failed to copy ${type}.`);
            });
        }
    </script>